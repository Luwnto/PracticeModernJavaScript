# ECMAScript 和 JavaScript的未来

谁也想不到，1995年被当做营销策略推出的JavaScript在2017年成为最受欢迎平台上的核心语言。JavaScript不仅是在浏览器中运行了，它同时被用作开发桌面和手机应用，嵌入式设备甚至被NASA拿来设计太空组件。

我们不禁要问，JavaScript是怎么取得今天的成就的，JavaScript未来又将朝哪里发展？

## JS标准简史

1995年，网景公司设想了一种超越HTML能力的动态网站，Brendan Eich被招进网景来开发一种供浏览器使用的类似Scheme的函数式语言。他加入时发现，公司高层希望这门语言看起来像Java，关于这种效果的交易也在暗中进行。

Brendan只花了10天就开发完成了第一版JavaScript的原型，这个新语言类似Scheme把函数当做一等公民，并以原型为其主要成分。最初的原型被称作Mocha，那时候它还没有数组和字面量的对象，所有的报错都通过`alert`展示，由于缺乏异常处理机制，也导致那时很多运算的结果是`NaN`或`undefined`。Brendan对DOM 0的描述及初版的JavaScript成为了最初的标准。

1995年九月，随着网景公司发布了beta版的Netscape Navigator 2.0，JavaScript被调整包装为LiveScript一同面试。1995年12月随着Netscape Navigator 2.0 beta3的发布，LiveScript又被改名为JavaScript(这个商标当时为Sun公司所有，现在归属甲骨文公司)。在这之后不久，网景在其自己的服务器（ Netscape Enterprise Server）上推出了名为LiveWire的服务器端的JavaScript执行<sup>[1](#cite1)</sup>。

1996年，微软推出了其JavaScript的反向设计实现-- JScript，并同ie3捆绑发行。JScript在微软的IIS服务器上同样可用。

JS语言在1996年开始已ECMAScript的名字被标准化到ECMA-262规范，规范者为ECMA组织下的一个名为TC39的技术委员会。当时Sun公司不愿意转让JavaScript这一商标，微软倒是愿意转让JScript这一商标但却遭到其它成员公司的反对，最终就叫ECMAScript了。

尽管是竞争关系，网景的JavaScript和微软的JScript还是在当时的TC39标准委员会占主导地位，尽管如此，委员会还是取得了大量的成果，向后兼容被设定为黄金法则，带来了严格相等运算符而没有破坏现有的依靠松散的平等比较算法的程序。

ECMA-262的第一版在1997年六月发布，一年后的1998年六月，该规范根据ISO / IEC 16262国际标准进行了改进，经过国家ISO认证机构的大量审查，正式发布为第二版。

1999年12月第三版发布了，规范了正则表达式，`switch`，`do/while`,`try/catch`和`Object#hasOwnProperty`，包括其它的一些改变，大部分新的改变都在网景的新版浏览器SpiderMonkey中得以实现。

ES4标准的草案很快也被TC39提出，ES4的早期工作直接影响了2000年中期的JScript .NET，以及2006年Flash推出了ActionScript 3。

关于JavaScript如何推进，当时的意见非常矛盾，这使规范工作停滞不前。这是Web标准的一个非常奇妙的时刻，这是微软掌握着网络的主动权，但是对规范的改进却没太大的兴趣。

直到两年后Brendan（现在在Mozilla），凭借获取火狐浏览器不断增长的份额迫使微软回到标准的议程中。2005年中期开始，TC39委员会又开始的例会。至于ES4，人们有计划引入模块系统，类，迭代器，生成器，解构，类型注释，适当的尾部调用，新的数据类型和各种其他功能。由于这个工程的野心太大，ES4被一而再的延期。

2007的委员会被分为两部分，ES3的渐进加强版ES3.1，以及重新设计改动巨大的ES4。到2008年8月，ES3.1被认为是正确的选择，之后被更名为ES5.尽管ES4被放弃了，它提出的很多新功能被融入了ES6，不过其它的一些功能仍然在考虑之中，有一些已被放弃，拒绝或撤回。ES3.1成为了ES4标准可以被通过的前提。

2009年12月，ES3发布10周年，第五版ECMAScript得以发布。这个版本把浏览器中的普遍实践标准化了，添加了`get``set`存取，改进了Array原型的函数式特征，在语言层面中支持了JSON的解析，以及严格模式。

几年后的2011年 6月，标准得以再次修改和改进成为 ISO/IEC 16262:2011标准的第三版，并以ES5.1正式发布。

又过了四年，在2015年6月，TC39公布了JS语言有史以来最大的更新ES6，其中包含了很多ES4中提出的被和谐的草案，本书，我们将深入探索ES6.

与ES6的标准提出的同时，在012年，WHATWG（一个意在推动网络发展的标准机构）开始记录ES5.1和浏览器实现之间的差异性，在兼容性和互操作性方面。该工作组标准化了以前未标准化的`String＃substr`。统一了几种之前浏览器中不一致的在HTML标签中包装字符串的方法，并记录了`Object.prototype`属性，如`__proto__`和`__defineGetter__`结合其它一些方面的改进，它们的努力得以浓缩为一个单独的web ES标准，并最终展现为ES2015的附录B中，附录B是核心ECMAScript规范的资料不符，意思是浏览器的实现不需要遵循其建议。与此更新一起，附件B也被制定为网络浏览器的规范和要求。

第六版是JavaScript历史上的一个重要里程碑。除了数十种新功能，ES6的发布是ECMAScript成为滚动标准的关键转折点。

## 作为滚动标准的ECMAScript

ES3发布了十年没有重大变化，花了四年才使得ES6标准化，很明显TC39处理效率需要改进了。修订过程曾经是由期限驱动的，只要未达成共识就会导致修订时间延长，这有引起特征的变化，导致更多的延迟。小的修订被标准大的更新推迟，面临压力，大的更新需要制定，是的修正得以通过，避免未来的延期。

不过自从ES6面试，TC39也流线化了。他们优化了修正过程使得其能满足现代需要更持续且频繁的需求，并且使得规范的发展更加民主化，在这一点上，TC39从一个古老的基于Word的流程转移到使用`Ecmarkup`（用于格式化ECMAScript规范的HTML超集）和Github request。这大大增加提案数量以及非会员参与度，新的流程是连续且更透明的，以往你需要从网上下载某个规范的word或pdf说明文稿，现在你随时可以通过[这个网站](https://mjavascript.com/out/spec-draft)看见最新的草案

现在Firefox，Chrome，Edge，Safari和Node.js都符合ES6规范超过95％的要求了，但是我们已经能够在每个这些浏览器中使用这些功能，并不需要等到他们百分百的被支持。

任何尚未提交为正式提案的讨论，想法或改变或补充的建议被认为是一个理想的草案（所谓的stage0），但只有TC39成员可以创建秸秆提案。在写这篇文章的时候，有十几个积极的草案。

在stage1，一个提案被正式化，并将逐步解决跨部门关切的问题，与其他提案的相互作用以及实施的问题。在这个阶段的提案应该确定一个离散的问题，并为问题提供具体的解决方案，第1阶段提案通常包括高级API描述，说明性使用示例以及内部语义和算法的讨论，通常第一阶段的提案在这个过程中可能会发生重大变化。

第2阶段的提案就有了规范的初始草案。此时，将开始在实际环境中运行，运行可以以`polyfill`的形式使得用户的代码遵守提案，引擎的实现也本地化的提供了对规范的支持，当然还有别的方法来使用，比如说使用构建工具来转换源代码，编译成现有引擎可以执行的代码。

state3阶段的代码属于候选推荐代码了，为了使规范达到这个阶段，规范编辑和指定审阅者必须在最终规范上签字，实施者也应该对建议表示兴趣，提案必须至少被一个浏览器实现，有高效的`ployfill`，或者被Babel支持，stage3的提议不太可能改变已经被公众确认的问题。

草案想要达到stage4阶段，必须有两个独立的实现通过验收测试，进入第4阶段的提案将包含在ECMAScript的下一个修订版中。

现在新的规范将会每年发布，也因此新的版本号包含年号，因此ES6又称ES2015，之后的版本叫ES2017而非ES7，以此类推。口头上，大家说ES2015的还是比较少，大家还是习惯喊ES6，ES2016在命名规则变更之前已经公布，因此有时仍被称为ES7，不过按照这一命名规则，我们之后会说ES6，ES2016，ES2017，ES2018等等。

精简提案流程和每年发布的新版本使得新版的发布得以持续化，不过这也意味着版本号不再那么重要了，现在大家都把精力放在提案上，我们对参考ECMAScript标准的期待反而变少了。

## 浏览器支持情况和兼容工具

第3阶段的候选推荐方案最有可能在下一步中被纳入规范。在JavaScript引擎中提供了两个独立的实现。事实上，第三阶段的提案一般被认为通过实验阶段的浏览器解析，`ployfill`或者编译器解析后，是可以安全的是生产环节中使用的。第二阶段的提案以及更早的提案也有被开发者运用到生产中的，这使得对规范的反馈更加便捷。

类似Babel这样，以代码作为输入，并输出web平台可用的HTML，CSS，JS的工具一般被称为编译器，或者转义器（编译器的子集），当我们想在我们的代码中写还不是正式标准的语法时，类似Babel这样的编译器就会把这些语法转换为目前浏览器广泛支持的语法。

这种转换一般在开发阶段转换，这样开发者就能得到被浏览器支持的代码。这种机制使得浏览器更早的‘支持了’新的规范，这让JS开发者更早享受到了新规范带来的好处。这对规范的作者和实践者也是大有裨益的，因为它允许他们收集更多关于可行性、可取性，可能的错误或边缘案例的反馈。

现阶段，转义器会把我们写的ES6代码转换为浏览器可识别的ES5代码，这是现今在生产环境使用ES6的最值得信赖的方案，通过一个build步骤使得我们的代码可以被老的浏览器（更不用说新浏览器）成功解析。

这种方法同样被运用到ES7以及更新的标准，由于新的标准每年都在推出，我们可以预见编译器会马上支持ES2017，ES2018等等。与此同时，由于浏览器对新标准的支持越来越好，编译器也会逐步减少对ES6代码的转译，ES7的转译等等。从这个角度看来，新JS到旧JS的转译器可以看做在生产环节中使用最新语法的连接器。

下面我们谈谈在你的工作流中该如何使用`Babel`。





















- [1] A [booklet from 1998](https://mjavascript.com/out/livewire) explains the intricacies of server-side JavaScript with LiveWire.